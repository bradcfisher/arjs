<!DOCTYPE html>
<html>
<head>
	<title>arjs - Alternate Reality for the web</title>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<script src="arjs.js"></script>
</head>
<body>

<div>Timestamp: <span id="Timestamp">?</span></div>
<div>Game date: <span id="GameTime">?</span></div>
<div>Date from timestamp: <span id="TimestampDate">?</span></div>
<div>Timestamp from date: <span id="DateTimestamp">?</span></div>
<div>NormalizedTime: <span id="NormalizedTime">?</span></div>

<div>
	<button onclick="gameTime.tickDelay = 1">Ultra Fast</button>
	<button onclick="gameTime.tickDelay = 16">Fast</button>
	<button onclick="gameTime.tickDelay = 200">Medium</button>
	<button onclick="gameTime.tickDelay = 4000">Normal</button>
</div>

<div>Timestamp: <input type="text" id="TimestampInput"/> <button onclick="gameTime.setCurrent($('#TimestampInput').val())">Apply</button></div>

<script>

let cal;
let gameTime;

$(document).ready(function() {
	console.log("document ready");
	$.getJSON("AR/shared/time.json").done(jsonLoaded);
});

function jsonLoaded(timeJson) {
	cal = new arjs.Calendar(timeJson.months);
	gameTime = new arjs.GameTime(cal);

	console.log("created calendar & game time");

	let ts = document.getElementById("Timestamp");
	let gt = document.getElementById("GameTime");
	let td = document.getElementById("TimestampDate");
	let dt = document.getElementById("DateTimestamp");
	let nt = document.getElementById("NormalizedTime");

	if (ts == null || gt == null || td == null || dt == null || nt == null)
		throw new Error("Unable to find required document element");

	function animate(now) {
		ts.innerHTML = String(gameTime.current);
		let a = gt.innerHTML = cal.dateToString(gameTime);
		let b = td.innerHTML = cal.dateToString(cal.timestampToDate(gameTime.current));
		let c = dt.innerHTML = cal.dateToTimestamp(gameTime);
		let d = nt.innerHTML = cal.dateToString(cal.normalizeDate(gameTime));

		gameTime.update(now);

/*
		if (a != b)
			console.error("The timestamps do not match (a,b): "+ a +" != "+ b);

		if (a != c)
			console.error("The timestamps do not match (a,c): "+ a +" != "+ c);

		if (b != c)
			console.error("The timestamps do not match (b,c): "+ b +" != "+ c);
*/

		requestAnimationFrame(animate);
	}

	requestAnimationFrame(animate);
}

</script>

</body>
</html>